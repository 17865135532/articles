# RDF 和 SPARQL 初探：以维基数据为例

维基百科有一个姐妹项目，叫做[“维基数据”](https://www.wikidata.org)（Wikidata）。你可以从维基百科左侧边栏点进去。

![](https://www.wangbase.com/blogimg/asset/202002/bg2020021801.jpg)

“维基数据”是将维基百科的所有数据，整理成一个可以机器处理的数据库，方便进行查询。比如，山西省人口最多的地区是哪一个？

这种问题在维基百科查询，是很费时的，必须人工从一个个条目提取信息。但是，维基数据可以只执行一条命令，就返回答案（详见后文）。因为它是数据库，所有信息是结构化的，可以机器查询。

但是，维基数据不是关系型数据库，而是 RDF 数据库；它的查询语言不是 SQL，而是 SPARQL。我粗浅地学了一点 RDF 和 SPARQL，本文就是学习笔记，并且演示如何使用维基数据查询信息。

![](https://www.wangbase.com/blogimg/asset/202002/bg2020021802.jpg)

## 一、RDF 的含义

大家都知道，关系型数据库是目前使用最广泛的数据库，将数据抽象成行和列的表格关系。

![](https://www.wangbase.com/blogimg/asset/202002/bg2020021905.jpg)

但是，现实世界更直观的描述，不是表格，而是网络。各种事物通过错综复杂的关系，连接在一起。

![](https://www.wangbase.com/blogimg/asset/202002/bg2020021906.jpg)

数学里面把网络关系称为图（graph），每样东西就是一个节点，节点之间的关系就是将它们连在一起的那条边。如果数据库以图的方式储存数据，就称为图数据库。

RDF 就是图数据库的一种描述方式，或者说是一种使用协议。它以“三元组”（ triple）的方式，描述事物与事物之间的直接关系。所谓“三元组”，就是指两个事物和它们之间的关系，在语法上呈现为“主语 + 谓语 + 宾语”。

比如，“天空是蓝色的”这句描述，就是一个 RDF 三元组。“天空”（主语）和“蓝色”（宾语）是两种事物，它们通过颜色关系（谓语）连接在一起。

RDF 要求对谓语（即事物之间的关系）给予明确定义。如果谓语是给定的，那么不管是什么数据库，就可以通过主语去查询宾语，或者通过宾语去查询主语。比如，颜色关系是给定的，那么就可以向数据库查询“天空 + 颜色关系 = ？”，或者“？ + 颜色关系 = 蓝色”。

任意组织和个人，都可以定义自己的谓语。RDF 要求每种定义都必须有一个明确的 URL，通过 URL 区分不同的谓语。比如，RDF 官方的谓语定义的地址是 [https://www.w3.org/1999/02/22-rdf-syntax-ns](https://www.w3.org/1999/02/22-rdf-syntax-ns) ，只要引用这个地址，就可以知道用的是哪一套谓语。

URL 比较冗长，引用不是很方便。RDF 允许指定一个前缀，代表 URL 地址，比如上面那个官方谓语的 URL，通常用前缀`rdf`表示。每个 URL 里面可以包含多种关系的定义，通过“前缀 + 关系”的形式来区分。比如，官方定义了一个“type”关系，表示宾语说明主语的类型，就可以用`rdf:type`表示。

“小明是学生”这个描述，就可以写成`小明 rdf:type 学生`。由于`rdf:type`是一个常用谓语，RDF 允许把它简写成`a`，因此“小明是学生”又可以表示成`小明 a 学生`。

## 二、 RDF 的语法示例

下面通过一个例子，演示 RDF 如何定义事物之间的关系。




## SPARQL 语法

[http://www.iro.umontreal.ca/~lapalme/ift6281/sparql-1_1-cheat-sheet.pdf](http://www.iro.umontreal.ca/~lapalme/ift6281/sparql-1_1-cheat-sheet.pdf)

https://www.stardog.com/tutorials/sparql/

https://programminghistorian.org/en/lessons/retired/graph-databases-and-SPARQL

[https://www.cambridgesemantics.com/blog/semantic-university/learn-sparql/sparql-nuts-bolts/](https://www.cambridgesemantics.com/blog/semantic-university/learn-sparql/sparql-nuts-bolts/)


山西省人口最多的地级市

```sql
SELECT ?area ?areaLabel ?popTotal
WHERE {
   wd:Q46913  wdt:P150 ?area .
   ?area rdfs:label ?areaLabel .
   FILTER(LANGMATCHES(LANG(?areaLabel), "zh-CN")) 
  
   ?area wdt:P1082 ?popTotal .
}
ORDER BY desc(?popTotal)
```

更多语法的例子可以看[这篇文章](https://www.cambridgesemantics.com/blog/semantic-university/learn-sparql/sparql-nuts-bolts/)。


## 参考链接

- [RDF](https://en.wikipedia.org/wiki/RDF)，Wikipedia
- [RDF Graph Data Model](https://www.stardog.com/tutorials/data-model), Stardog

