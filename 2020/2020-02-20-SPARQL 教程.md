# RDF 和 SPARQL 初探：以维基数据为例

维基百科有一个姐妹项目，叫做[“维基数据”](https://www.wikidata.org)（Wikidata）。你可以从维基百科左侧边栏点进去。

![](https://www.wangbase.com/blogimg/asset/202002/bg2020021801.jpg)

“维基数据”将维基百科的所有数据，整理成一个可以机器处理的数据库，方便查询。比如，山西省人口最多的地区是哪一个？

这种问题在维基百科查询，非常费时，必须人工从一个个条目提取信息。但是，维基数据可以只执行一条命令，就返回答案（详见后文）。因为它是数据库，所有信息是结构化的，可以机器查询。

但是，维基数据不是关系型数据库，而是 RDF 数据库；它的查询语言不是 SQL，而是 SPARQL。我粗浅地学了一点 RDF 和 SPARQL，本文就是学习笔记，演示如何使用维基数据查询信息。

![](https://www.wangbase.com/blogimg/asset/202002/bg2020021802.jpg)

## 一、RDF 的含义

大家都知道，关系型数据库是目前使用最广泛的数据库，将数据抽象成行和列的表格关系。

![](https://www.wangbase.com/blogimg/asset/202002/bg2020021905.jpg)

但是，现实世界不像表格，更像网络。各种事物通过错综复杂的关系，连接在一起，组成一张网。

![](https://www.wangbase.com/blogimg/asset/202002/bg2020021906.jpg)

网络在数学里面称为图（graph），每样东西就是图的一个节点，节点之间的关系就是将它们连在一起的那条边。如果数据库以图的方式储存数据，就称为图数据库。

**RDF 就是图数据库的一种描述方式，或者说是一种使用协议。它以“三元组”（ triple）的方式，描述事物与事物之间的直接关系。** 所谓“三元组”，就是两个事物和它们之间的关系，在语法上呈现为“主语 + 谓语 + 宾语”。

> 天空是蓝色的。

上面这句话，就是一个 RDF 三元组。“天空”（主语）和“蓝色”（宾语）是两种事物，它们通过颜色关系（谓语）连接在一起。

![](https://www.wangbase.com/blogimg/asset/202002/bg2020022001.jpg)

RDF 要求，谓语（即事物之间的关系）必须有明确定义。大家可以这样想，如果谓语是给定的，那么不管什么数据库，就可以通过主语去查询宾语，或者通过宾语去查询主语。比如，颜色关系是给定的，那么就可以向数据库进行下面的查询。

> 查询一：天空 + 颜色 = ？
> 
> 查询二：？ + 颜色 = 蓝色

任何组织和个人，都可以定义自己的谓语。RDF 要求每种定义都必须有一个明确的 URL，通过 URL 区分不同的谓语。RDF 官方定义了一套常用的谓语，URL 如下。

>  [https://www.w3.org/1999/02/22-rdf-syntax-ns](https://www.w3.org/1999/02/22-rdf-syntax-ns) 

使用的时候，只要引用这个 URL，别人就知道用的是哪一套谓语。

URL 比较冗长，引用不是很方便。RDF 允许指定一个前缀，代表 URL 地址，比如上面那个官方谓语的 URL，通常用前缀`rdf`表示。

```sql
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns>
```

每个 URL 里面可以包含多种关系的谓语，通过“前缀 : 关系”的形式来区分。比如，官方定义了一个“type”关系，表示宾语说明主语的类型，就可以用`rdf:type`表示。

> 小明是学生。

上面这句话，写成 RDF 三元组，就是下面的形式。

```sql
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns>
 
小明 rdf:type 学生.
```

由于`rdf:type`是一个常用谓语，RDF 允许把它简写成`a`，因此“小明是学生”又可以表示成`小明 a 学生`。

```sql
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns>

小明 a 学生 .
```

注意，每个 RDF 三元组的结尾是一个英文的句号，用来区分多个三元组。

## 二、 RDF 的语法示例

下面通过一个例子，演示 RDF 如何定义事物之间的关系。

> 甲壳虫是一个乐队，成员有 John Lennon、Paul McCartney、Ringo Starr 和George Harrison。他们都是艺术家，1963年出版过一张专辑《Please Please Me》，里面包含《Love Me Do》这首单曲，长度125秒。

上面这段话，是自然语言的文本。我们先画出网络关系图。

![](https://www.wangbase.com/blogimg/asset/202002/bg2020022002.jpg)

然后，转成 RDF 三元组。首先，给出谓语的 URL，及其对应的前缀。

```sql
PREFIX : <http://foo.com/tutorial/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns>
```

上面的代码中，有两个 URL，表示使用两套谓语。其中一套是官方谓语，使用前缀`rdf`表示；另一套是自己定义的，前缀为空，表示这是默认的前缀。

”甲壳虫是一个乐队，成员有 John Lennon、Paul McCartney、Ringo Starr 和George Harrison。“这句话对应的三元组如下。

```sql
甲壳虫 rdf:type  Band .
甲壳虫 :name "甲壳虫" .
甲壳虫 :member John_Lennon .
甲壳虫 :member Paul_McCartney .
甲壳虫 :member Ringo_Starr .
甲壳虫 :member George_Harrison .
```

上面的代码中，`rdf:type`、`:name`、`:member`都是谓语。由于这些三元组的主语相同，RDF 允许将它们合并。

```sql
甲壳虫 a 乐队 ;
      :name "甲壳虫" ;
      :member John_Lennon, Paul_McCartney, George_Harrison, Ringo_Starr .
```

上面的代码中，主语相同的三元组采用合并写法时，每个三元组之间使用分号隔开，最后一个三元组采用句号结尾。

其余部分对应的 RDF 三元组如下。

```sql
John_Lennon      a 艺术家 .
Paul_McCartney   a 艺术家 .
Ringo_Starr      a 艺术家 .
George_Harrison  a 艺术家 .
Please_Please_Me a 专辑 ;
                 :name "Please Please Me" ;
                 :date "1963" ;
                 :artist "甲壳虫" ;
                 :track Love_Me_Do .
Love_Me_Do       a Song ;
                 :name "Love Me Do" ;
                 :length 125 .
```


## SPARQL 语法

[http://www.iro.umontreal.ca/~lapalme/ift6281/sparql-1_1-cheat-sheet.pdf](http://www.iro.umontreal.ca/~lapalme/ift6281/sparql-1_1-cheat-sheet.pdf)

https://www.stardog.com/tutorials/sparql/

https://programminghistorian.org/en/lessons/retired/graph-databases-and-SPARQL

[https://www.cambridgesemantics.com/blog/semantic-university/learn-sparql/sparql-nuts-bolts/](https://www.cambridgesemantics.com/blog/semantic-university/learn-sparql/sparql-nuts-bolts/)


山西省人口最多的地级市

```sql
SELECT ?area ?areaLabel ?popTotal
WHERE {
   wd:Q46913  wdt:P150 ?area .
   ?area rdfs:label ?areaLabel .
   FILTER(LANGMATCHES(LANG(?areaLabel), "zh-CN")) 
  
   ?area wdt:P1082 ?popTotal .
}
ORDER BY desc(?popTotal)
```

更多语法的例子可以看[这篇文章](https://www.cambridgesemantics.com/blog/semantic-university/learn-sparql/sparql-nuts-bolts/)。


## 参考链接

- [RDF](https://en.wikipedia.org/wiki/RDF), Wikipedia
- [RDF Graph Data Model](https://www.stardog.com/tutorials/data-model), Stardog

（完）
