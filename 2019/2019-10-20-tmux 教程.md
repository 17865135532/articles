# Tmux 使用教程

Tmux 是一个终端复用器（terminal multiplexer），非常有用，属于常用的开发工具。

本文介绍如何使用 Tmux。

## 一、Tmux 是什么？

命令行的典型使用方式是，打开一个终端窗口（terminal window，以下简称“窗口”），在里面输入命令。

用户与计算机的这种临时的交互，称为一次“会话”（session）：打开窗口，会话开始；关闭窗口，会话结束。

会话的一个重要特点是，窗口与其中启动的进程是连在一起的。如果会话终止，窗口消失，那么该会话内部的进程也会随之终止，不管有没有运行完。

一个典型的例子就是，SSH 登录远程计算机，打开一个远程窗口，执行一个命令。这时网络突然断线，再次登录的时候，是找不回上一次执行的命令的。因为前一次 SSH 会话已经终止了，进程也随之消失了。

这样有时很不方便，开发者会想让会话与进程“解绑”：会话结束时，进程并不终止，而是继续运行，等到以后需要的时候，再让进程“绑定”其他会话上面。

**Tmux 就是这种会话与进程的“解绑”工具，将会话、窗口、进程彻底分离。**

（1）它允许在单个窗口中，同时访问多个会话。这对于同时运行多个命令行程序很有用。

（2） 它可以将进程与窗口分离，从而使 SSH 会话可以关闭窗口后重新打开。

（3）它允许每个会话，有多个连接它的窗口，因此可以多人实时共享会话。

（4）它还支持窗口任意的垂直和水平拆分（即窗格，panel）。

GNU Screen 也是一个著名的终端复用器，Tmux 与它功能相似，但是更易用，也更强大。

## 二、基本用法

Tmux 一般需要自己安装。

```bash
# Ubuntu 或 Debian
$ sudo apt-get install tmux

# CentOS 或 Fedora
$ sudo yum install tmux

# Mac
$ brew install tmux
```

安装完成，键入`tmux`命令，就进入了 Tmux 窗口。

```bash
$ tmux
```

上面命令会启动 Tmux 窗口，底部有一个状态栏。状态栏的左侧是窗口信息（编号和名称），右侧是系统信息。

按下`Ctrl + d`或者显式输入`exit`，就可以退出 Tmux 窗口。

```bash
$ exit
```

Tmux 窗口有大量的快捷键。所有快捷键都要通过前缀键唤起。默认的前缀键是`Ctrl + b`，即先按下`Ctrl + b`，快捷键才会生效。

举例来说，帮助命令的快捷键是`Ctrl + b ?`。在 Tmux 窗口中，先按下`Ctrl + b`，再按下`?`，就会显示帮助信息。这时按下 ESC 键或输入`q`，就可以退出帮助。

## 三、会话管理

第一个启动的 Tmux 窗口，默认编号是`0`，第二个窗口的编号是`1`，以此类推。这些窗口对应的会话，依次是 0 号会话、1 号会话等等。

使用编号区别会话，不太直观，更好的方法是为会话起名。

```bash
$ tmux new -s [sessionName]
```

上面命令创建一个指定名称的会话。

进入 Tmux 窗口以后，按下`Ctrl + b d`或者输入`tmux detach`命令，就会将当前会话与窗口分离。

```bash
$ tmux detach
```

上面命令执行后，就会退出当前 Tmux 窗口，但是会话和里面的进程仍然在后台运行。

`tmux ls`命令可以查看当前所有的 Tmux 会话。

```bash
$ tmux ls
# or
$ tmux list-session
```

下面命令用于重新接入某个会话。

```bash
# 使用会话编号
$ tmux  attach -t 0

# 使用会话名称
$ tmux attach -t [sessionName]
```

下面的命令用于杀死某个会话。

```bash
# 使用会话编号
$ tmux kill-session -t 0

# 使用会话名称
$ tmux kill-session -t [sessionName]
```

在一个 Tmux 会话之中，可以使用`tmux switch`命令，切换到另一个会话。

```bash
# 使用会话编号
$ tmux switch -t 0

# 使用会话名称
$ tmux switch -t [sessionName]
```

## 四、最简操作流程

综上所述，以下是Tmux入门的最基本步骤：

1.  在命令提示，类型`tmux new -s my_session`，
2.  运行所需的程序。
3.  使用键序列`Ctrl-b`+ `d`从会话中分离。
4.  通过键入重新连接到Tmux会话`tmux attach-session -t my_session`。

## 四、窗格操作

将窗格分为左右两边的快捷方式是`C-b %`。记住我刚才告诉你的TMUX的序列**前缀**和**命令键**，这意味着你的单一界面分成左，你按下右边的窗格中`Ctrl`，并`b`在同一时间，松开两个，然后键入`%`关键。瞧！您刚刚调用了第一个tmux命令，并将窗格分为两部分。

分为左右两边的地方，也分为上下两边的窗格。要将窗格分为顶部窗格和底部窗格，请使用`C-b "`快捷方式。

切换到其他窗格使用C-b <arrow key>快捷方式，其中<箭头键>是指向要切换到的窗格的箭头键。

关闭窗格就像关闭常规终端会话一样简单。无论是键入`exit`还是点击`Ctrl-d`，它都消失了。

```bash
`tmux split-window (prefix + ")`

将窗口分为两个垂直窗格

`tmux split-window -h (prefix + %)`

将窗口分为两个水平窗格

`tmux swap-pane -[UDLR] (prefix + { or })`

在指定的方向上将窗格与另一个交换

`tmux select-pane -[UDLR]`

选择指定方向的下一个窗格

`tmux select-pane -t :.+`

按数字顺序选择下一个窗格
```

```bash
-   `Ctrl+b`  `c` 创建一个新窗口（带外壳）
-   `Ctrl+b`  `w` 从列表中选择窗口
-   `Ctrl+b`  `0` 切换到窗口0（按数字）
-   `Ctrl+b`  `,` 重命名当前窗口
-   `Ctrl+b`  `%` 将当前窗格水平拆分为两个窗格
-   `Ctrl+b`  `"` 将当前窗格垂直拆分为两个窗格
-   `Ctrl+b`  `o` 转到下一个窗格
-   `Ctrl+b`  `;` 在当前窗格和上一个窗格之间切换
-   `Ctrl+b`  `x` 关闭当前窗格
```

## 窗口管理

创建新的窗口是打字一样简单C-b c（最后一次：这是Ctrl和b一次，然后c）。然后，新窗口将在tmux的状态栏中显示给您。

要切换到上_一个_窗口（根据状态栏中的顺序），请使用`C-b p`，要切换到_下一个_窗口，请使用`C-b n`。如果您创建了许多窗口，则可能会发现通过直接输入窗口编号直接进入窗口很有用（状态栏将告诉您哪个窗口具有哪个编号），只需使用`C-b <number>`<number>是窗口前面的数字在状态栏中输入名称。

```bash
`tmux new-window (prefix + c)`

创建一个新窗口

`tmux select-window -t :0-9 (prefix + 0-9)`

根据索引移至窗口

`tmux rename-window (prefix + ,)`

重命名当前窗口
```

## 会话操作

要分离当前会话，请使用`C-b d`。您还可以使用`C-b D`tmux来选择要分离的会话。这将分离您的会话，但将使您在后台运行的会话中完成工作。

现在您的会话已分离，您可以在以后的任何时间从离开它的位置进行拾取。要重新附加到会话，您需要先确定要附加到哪个会话。通过使用来确定正在运行的会话

```bash
$ tmux ls
```

这将为您提供所有正在运行的会话的列表，在我们的示例中，该列表应类似于

```bash
> 0：2个窗口（2015年8月15日星期六创建）[199x44]（分离）
```

要连接到该会话，请再次启动tmux，但这一次告诉它要附加到哪个会话：

```bash
$ tmux attach -t 0
```

注意，该`-t 0`参数告诉tmux附加到哪个会话。“ 0”是`tmux ls`输出的第一部分。

如果您希望为会话指定一个更有意义的名称（而不是以0开头的数字），则可以使用

```
tmux new -s database

```

这将创建一个名为“数据库”的新会话。

您还可以重命名现有会话：

```
tmux rename-session -t 0 database

```

下次附加到该会话时，只需使用`tmux attach -t database`。如果您一次使用多个会话，则可以成为一项必不可少的功能。

就是这样！恭喜，您刚刚完成了第一个tmux会话，

## 其他命令

只需键入`C-b ?`即可查看所有可用命令的列表并开始实验。

我经常使用的一些命令是：

-   `C-b z`：使窗格全屏显示。`C-b z`再次点击以将其缩小到以前的大小
-   `Ctrl-b Ctrl-<arrow key>`：沿<箭头键> [4](https://www.hamvocke.com/blog/a-quick-and-easy-guide-to-tmux/#fn:4)方向调整窗格大小
-   `Ctrl-b ,`：重命名当前窗口

```bash
tmux list-keys
列出每个绑定键及其运行的tmux命令
tmux list-commands
列出每个tmux命令及其参数
tmux info
列出每个会话，窗口，窗格，其pid等。
tmux source-file ~/.tmux.conf
重新加载当前的tmux配置（基于默认的tmux配置）
```

### Basics

-   **`?`**  get help

### Session management

-   **`s`**  list sessions
-   **`$`**  rename the current session
-   **`d`**  detach from the current session

### Windows

-   **`c`**  create a new window
-   **`,`**  rename the current window
-   **`w`**  list windows
-   **`%`**  split horizontally
-   **`"`**  split vertically
-   **`n`**  change to the next window
-   **`p`**  change to the previous window
-   **`0 to 9`**  select windows 0 through 9

### Panes

-   **`%`**  create a horizontal pane
-   **`"`**  create a vertical pane
-   **`h`**  move to the left pane. *
-   **`j`**  move to the pane below *
-   **`l`**  move to the right pane *
-   **`k`**  move to the pane above *
-   **`q`**  show pane numbers
-   **`o`**  toggle between panes
-   **`}`**  swap with next pane
-   **`{`**  swap with previous pane
-   **`!`**  break the pane out of the window
-   **`x`**  kill the current pane

## 参考链接

- [A Quick and Easy Guide to tmux](https://www.hamvocke.com/blog/a-quick-and-easy-guide-to-tmux/)
- [Tactical tmux: The 10 Most Important Commands](https://danielmiessler.com/study/tmux/)
- [Getting started with Tmux](https://linuxize.com/post/getting-started-with-tmux/)


