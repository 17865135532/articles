# H5 手机 App 开发入门：技术篇

新人学习手机 App 开发，总是要选择一条学习路径。

如果你熟悉 Java 语言，可以学习安卓开发；如果熟悉 C++ 语言，那么 Object-C 语言应该也没问题，可以优先考虑 iOS 开发；如果像我一样，比较熟悉 Web 网页技术，那么 H5 开发是最容易上手的。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121401.jpg)

本文就来谈谈，如何开发一个 H5 App。

这个系列教程的第一篇，已经介绍过[什么是 H5  App](http://www.ruanyifeng.com/blog/2019/12/hybrid-app-concepts.html) 了，其实就是混合 App，外面是一个原生的壳，里面是 Web 网页。今天紧接上一篇，介绍手机 App 的开发方法，也就是会用到的技术栈。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121402.jpg)

## 一、手机 App 的技术栈

手机 App 的技术栈可以分成三类。

（1）**原生 App 技术栈** （native technology stack）

原生技术栈就是，只能用于特定手机平台的开发技术。比如，安卓平台的 Java 技术栈，iOS 平台的 Object-C 技术栈或 Swift 技术栈。

这种技术栈只能用在一个平台，对其他平台没有作用。

（2）**混合 App 技术栈** （hybrid technology stack）

混合技术栈就是开发混合 App 的技术，涉及到如何把 Web 网页放到特定的容器中，然后再打包成各个平台的原生 App。所以，混合技术栈其实是 Web 技术栈 + 容器技术栈，典型代表是 PhoneGap、Cordova、Ionic。

如果已经掌握了 Web 技术，这个技术栈需要学习的，就主要是容器提供的 API Bridge，网页通过它们去调用底层硬件的 API。 

（3）**跨平台 App 技术栈** （cross-platform technology stack）

跨平台技术栈指的是使用一种技术，同时支持多个手机平台。它与混合技术栈的区别是，不使用 Web 技术，即它的页面不是 HTML5 页面，而是使用自己的语法写的 UI 层，然后编译成各平台的原生 App。

这个技术栈就是纯粹的容器技术栈，React Native、Xamarin、Flutter 都属于这一类。学习的时候，除了要学容器的 API Bridge，还要学容器提供的 UI 层，即怎么写页面。

（4）**小结**

H5 开发主要用在混合技术栈。但是，跨平台技术栈的某些容器也会用到（比如 React Native），因为它们的 UI 层借鉴了 Web 模型。

另外，混合技术栈和跨平台技术栈的基础，都是原生技术栈，因为它们最终都要编译成原生App。所以，多多少少也要了解一些各平台的底层技术。

下面就依次介绍这三类技术栈，每个技术栈都会实现一个最简单的例子：加载网页。通过 App 加载网页的不同做法，帮助大家理解不同技术栈的特点，对 App 的技术实现有一个总体的认识。

## 二、WebView 控件

讲解具体的技术栈之前，大家需要知道，不管什么技术，最终在 App 里面显示网页，一定需要一个网页引擎，这样才能解析网页。

通常情况下，App 内部会使用 WebView 控件作为网页引擎。这个控件专门用来显示网页，各种系统都已经自带了。应用程序的界面，只要放上 WebView，就能显示网页。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121404.jpg)

不同的 App 技术栈要显示网页，区别仅仅在于怎么处理 WebView 这个原生控件。原生技术栈需要开发者自己把 WebView 控件放到页面上；混合技术栈的页面本身就是网页，默认在 WebView 中显示；跨平台技术栈则会提供一个 WebView 的语法，编译的时候将其换成原生的 WebView。

注意，不同系统的 WebView 控件名称不一样，安卓系统就叫 WebView，iOS 系统有较老的 UIWebView，也有较新的 WKWebView，作用都是一样的，差异在于功能的强弱。

## 三、原生技术栈

简单说，iOS 的原生技术栈就是使用 Object-C 语言或 Swift 语言，在 Xcode 开发环境中编程。安卓的原生技术栈，则是使用 Java 语言或 Kotlin 语言，开发环境是 Android Studio。

下面就来看看，它们怎么加载网页。

### 3.1 Xcode

iOS 开发首先需要安装 Xcode。它是一种集成开发环境（IDE），也是苹果公司指定的 iOS 官方开发工具，所有苹果手机的 App 都由它打包生成。

它可以在 Mac 电脑上通过应用商店免费安装。注意，Xcode 只支持 Mac 系统，不支持其他系统。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121215.jpg)

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121214.jpg)

安装完成后，点击打开，新建一个项目，类型是单视图 App，然后系统会询问一些项目参数和储存位置，这里就不详细说明了。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121216.jpg)

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121217.jpg)

然后，就进入了编程页面。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121219.jpg)

在左侧的目录树里面，找到`ViewController.swifter`文件，它负责视图逻辑。按照[官方文档](https://developer.apple.com/documentation/webkit/wkwebview)，在，填入下面的代码。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121220.jpg)

上面代码的意思是，App 启动加载视图的时候（`loadView()`），新建一个 WebView 控件的实例。视图加载成功后（`viewDidLoad()`），WebView 再去加载外部网页（红框部分）。

这样就可以了。点击工具栏的运行按钮，Xcode 就会弹出一个 iPhone 模拟器，里面就是当前代码的运行结果。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121221.jpg)

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121222.jpg)

如果一切正常，就可以让 Xcode 对源码打包，生成 App 的二进制安装文件。

### 3.2 Android Studio

安卓的官方开发工具是 Android Studio，可以去[官网](https://developer.android.com/studio)下载。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121224.jpg)

安装完成后，点击打开，选择新建一个项目，类型是“Empty Activity”。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121225.jpg)

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121226.jpg)

Android Studio 会询问项目参数，包括项目名称、开发语言（Java）等，然后就进入了开发环境。因为它是基于 Java IDE 修改的，懂 Java 的朋友应该对这个界面比较熟悉。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121227.jpg)

按照网上的[这篇教程](https://codingislove.com/android-web-view/)，接下来需要修改三个文件，其中最主要的是把`MainActivity.java`文件改成下面这样。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121228.jpg)

上面红框处的代码，就是在页面上添加并设置 WebView 实例，指定生成视图的时候（`onCreate()`），WebView 实例去加载外部网页。

运行代码之前，Android Studio 要求必须连接真机，或安装安卓模拟器。完成以后后，在工具栏上点击旁边的运行按钮，就可以运行代码了。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121229.jpg)

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121230.jpg)

如果一切正常，就可以让 Android Studio 打包，生成 App 的二进制安装文件。

## 四、混合技术栈

PhoneGap，Cordova，Ionic

前面介绍的是，如何在 iOS 和安卓的原生 App 里面加载网页，这就是混合 App 的原理：底层容器通过 WebView 展示网页。

但是，没有人在 Xcode 和 Android Studio 里面开发混合 App，因为太不方便了。实际上，大家都采用专门的混合 App 开发框架。这些框架把底层容器的细节都封装了，提供各种各样的接口，给网页调用。

这一类框架之中，历史最悠久是 [PhoneGap](https://phonegap.com/)，诞生于2009年。后来在2011年被 Adobe 收购，改名为 Adobe PhoneGap。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121235.jpg)

Adobe 将 PhoneGap 的核心代码，后来都捐给了 Apache 基金会，作为一个全新的开源项目，改名为 [Apache Cordova](https://cordova.apache.org/)。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121236.jpg)

PhoneGap 和 Cordova 现在都是独立发展的软件，它们的关系有点像 Safari 和 WebKit 的关系：Cordova 是 PhoneGap 的内核，PhoneGap 是 Cordova 的发行版。

再往后，Cordova 作为一个开源的混合 App 引擎，又有许多开源框架基于它诞生，其中比较著名的有 [Ionic](https://ionicframework.com/)、[Monaca](https://monaca.io/)、[Framework7](https://framework7.io/) 等。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121237.jpg)

上面所有这些框架，都是非常纯粹的混合 App 框架。它们都使用 Web 技术（HTML5 + CSS + JavaScript）开发页面，底层由 Cordova 项目提供容器和 JSBridge，允许网页调用系统的硬件。用户只需要做出页面，交给框架打包，编译成 iOS 和安卓平台的 App 就可以了。

它们的优点是容易开发、周期短、成本低，但都有共同的缺点：功能和性能都很有限。

下面就以 Ionic 框架为例，演示如何在 App 页面中嵌入一个外部网站。首先，根据[官方文档](https://ionicframework.com/docs/react/your-first-app)，生成项目的脚手架。

```bash
$ npm install -g ionic@latest
$ ionic start myApp blank --type=react
$ cd myApp
```

然后，在本机起一个 Web 服务，看看 Demo 的效果。

```bash
$ ionic serve
```

上面命令会自动打开浏览器窗口，访问本机的8100端口`http://localhost:8100`。所有纯粹基于 HTML5 的混合 App，因为都是纯网页，所以可以在浏览器中查看效果。

如果一切正常，在命令行窗口按 Ctrl+c，退出服务。

接下来，打开`src/pages/Home.tsx`文件，在`<IonContent>`标签里面插入`<iframe>`标签即可。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121238.jpg)

上面代码中，`<iframe>`标签就可以插入外部网页。

然后，使用`ionic serve`命令在本地浏览器查看效果。编译成二进制的 App 安装包的方法可以参考[官方文档](https://ionicframework.com/docs/react/your-first-app#build-a-native-app)。

## 五、React Native

纯粹的 HTML5 混合 App 有着明显缺点，就是性能不佳，无法充分利用硬件。网页控件相比原生控件，短板很明显。

xxx年，脸书公司的 React 框架诞生。这个框架最初是为网页开发设计的，核心思想就是在网页之上，建立一个 UI 的抽象层，所有数据操作都在这个抽象层完成，然后再渲染成网页的 DOM 结构，这样就提升了性能。

很快就有脸书的工程师想到了，既然 UI 渲染层可以渲染成 Web 网页，那么当然也可以渲染成 iOS 或者安卓系统的原生页面。这样的话，只要写一次 React 页面，就能同时编译成 iOS 和安卓的原生 App。这就是 React Native 项目的诞生。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121302.jpg)

注意，React Native 的原理与上面的 Cordova、Ionic 等等纯 H5 框架是不一样的。它其实不是混合 App 框架，因为它编译出来的不是混合 App，而是不同平台的原生 App（分别支持 iOS 和安卓），所以只能算跨平台的 App 框架。React Native 根本不是把网页放在容器的 WebView 里展示，实际上根本没有用到网页，而是把它自己的 UI 抽象层的控件，一一对应改成原生控件，编译 iOS 时翻译成 iOS 控件，编译安卓时翻译成安卓控件，这样编译出原生 App。举例来说，React Native 的文本渲染控件`<Text>`在 iOS 解释为`UIView`，在安卓解释为`TextView`。

这种方法即保证了性能，又只需写一次代码，同时兼具了原生 App 和混合 App 的优点。所以，一经诞生，就引起全球开发者的关注，成了手机 App 开发技术的热点。

下面也是在 React Native 里面加载外部网页，让大家感受一下 React Native 的开发风格。

React Native 写出来的不是 Web 网页，没法在浏览器预览，需要在手机模拟器或真机上才能看到效果。这样很不方便，所以脸书提供了另一个简便的方法，首先在手机安装一个叫做 Expo 的 App（[App Store](https://itunes.apple.com/app/apple-store/id982107779)，[Google Play](https://play.google.com/store/apps/details?id=host.exp.exponent)）。

然后，安装脚手架工具`expo-cli`，建立一个示意项目。选择minimum 模板，然后会要求项目描述 displayName，可以随便写一个。

```bash
$ npm install -g expo-cli
$ expo init rnDemo
$ cd rnDemo
$ npm install --save react-native-webview
```

打开 App.js，改成下面的代码。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121303.jpg)


上面代码中，`WebView`控件是 React Native 提供的。编译的时候，会分别转成 iOS 和安卓的原生 WebView 控件。

接下来，先把它编译成 Web 版，这样比较快，可以立刻看到效果。

```bash
$ npm run web
```

运行上面的命令，命令行会出现一个二维码。同时，还会自动打开浏览器，也会显示这个二维码。这时，手机端打开 Expo 客户端，扫描这个二维码，就会显示 App 的页面。注意，计算机和手机必须在同一个局域网。

除了 React Native，还有一个 [NativeScript](https://www.nativescript.org/) 项目，也是做类似的事情，把 JavaScript 编译成原生控件。不过，它的开发模型是基于 Angular.js。

React Native 的实现，虽然描述得很理想，但实现过程中存在各种各样的问题。最主要的问题，它把 UI 抽象层翻译成 iOS 和安卓过程中，做不到完全一致，两个客户端是有差异的，还会出现各种奇怪的小毛病。

如果你想充分发挥原生控件的功能，并且做到 iOS 和安卓体验一致，这要求开发者同时熟悉 React Native、iOS、安卓三个平台，这实在是要求太高了。Airbnb 在使用两年后，宣布放弃 React Native，改用原生 App。他们写了一篇[很长的文章](https://medium.com/airbnb-engineering/sunsetting-react-native-1868ba28e30a)，解释为什么这么做，以及 React Native 到底有什么问题，大家可以参考。

## 六、Xamarin

Xamarin 也是跨平台软件开发工具，属于微软公司，原理跟 React Native 很相似，只不过它采用 C# 语言来编写 UI 抽象层。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121304.jpg)

它的使用需要 Visual Studio，这里就不举例怎么开发。根据[官方文档](https://docs.microsoft.com/en-us/dotnet/api/xamarin.forms.webview?view=xamarin-forms)，WebView 的用法如下。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121305.jpg)

上面代码中，首先新建了一个 WebView 控件的实例，然后把这个实例放到布局上。

## 七、Flutter

[Flutter](https://flutter.dev/) 也是跨平台开发框架，它是自己实现了一套控件。打包的时候，会把这套控件打包进去每一个 App，因此它在 iOS 和安卓体验是完全一样的。

很多人都看好的这个框架，但是它比较新，现在应用还不广泛，API 也没稳定下来。但是值得进一步观察。

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121307.jpg)

它如何插入外部网页，可以参考 Flutter 官方团队的[这篇文章](https://medium.com/flutter/the-power-of-webviews-in-flutter-a56234b57df2)。核心代码如下：

![](https://www.wangbase.com/blogimg/asset/201912/bg2019121309.jpg)

上面代码使用的是 Dart 语言。它是 Flutter 的官方语言，跟 TypeScript 很像，都是在 JavaScript 语言的基础上加上静态类型支持。

（完）
